{% extends "base.html" %}
{% load filters %}
{% load bootstrap %}
{% block title %}日報の一覧{% endblock title %}

{% block content %}
{% if userinfo %}
    <h3 class="page-header">{{userinfo.username}}さんの投稿</h3>
{% else %}
    <h3 class="page-header">日報の一覧</h3>
{% endif %}
<form action="{% url 'cms:date_assign_daily' %}" method="GET">
    {% csrf_token %}
    {{ date_form.date }}
    <button type="submit" class="btn btn-default">絞り込み</button>
    <a href="{% url 'cms:task_mod' %}" class="btn btn-default">すべて表示</a>
</form>
<table class="table table-striped table-bordered">
<thead>
    <tr>
        <th>投稿者</th>
        <th>タイトル</th>
        <th>本文</th>
        <th>投稿日</th>
        <th></th>
    </tr>
</thead>
    <tbody>
        {% for daily in dailys %}
        <tr>
            <td><a href="{% url 'cms:user_info' user_id=daily.user.id %}">{{ daily.user }}</a></td>
            <td><a href="{% url 'cms:daily_detail' daily_id=daily.id %}"> {{ daily.title|truncate:"30" }}</a></td>
            <td>{{ daily.report_w|truncate:"30" }}</td>
            <td>{{ daily.create_date }}</td>
            <td>
                {% if userinfo %}
                    {% if daily.user == user %}
                        <a href="{% url 'cms:daily_detail' daily_id=daily.id %}" class="btn btn-default btn-sm btn-primary">詳細</a>
                        <a href="{% url 'cms:daily_mod' daily_id=daily.id %}" class="btn btn-default btn-sm">修正</a>
                        <button class="btn btn-default btn-sm del_confirm" data-toggle="modal" data-target="#deleteModal" pk="{{ daily.id }}" url="{% url 'cms:daily_del' daily_id=daily.id %}">削除</button>
                    {% else %}
                        <a href="{% url 'cms:daily_detail' daily_id=daily.id %}" class="btn btn-default btn-sm btn-primary">詳細</a>
                        <a href="{% url 'cms:comment_add' daily_id=daily.id %}" class="btn btn-default btn-sm">コメントの追加</a>
                    {% endif %}
                {% else %}
                    <a href="{% url 'cms:daily_detail' daily_id=daily.id %}" class="btn btn-default btn-sm btn-primary">詳細</a>
                    <a href="{% url 'cms:comment_add' daily_id=daily.id %}" class="btn btn-default btn-sm">コメントの追加</a>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<form action="{% url 'cms:task_mod' %}" method="GET">
    <h4>今日のタスク</h4><br>
    {{ task_form.management_form }}
    {% for form in task_form %}
        {% csrf_token %}
        {% if forloop.last %}
            {{form.id}}
            {{form.complete_task}}
            {{form.implement_date.label_tag}}{{form.implement_date}}
            {{form.name}}<br>
            予定{{form.time_plan}}
            /実績{{form.time_real}}<br>
        {% else %}
            {{form.id}}
            {{form.complete_task}}
            {{form.implement_date.label_tag}}{{form.implement_date.value}}
            {{form.name.value}}<br>
            予定{{form.time_plan.value}}
            /実績{{form.time_real}}<br>
            <a style="display:none">{{form.implement_date}}</a>
            <a style="display:none">{{form.name}}</a>
            <a style="display:none">{{form.time_plan}}</a>
            <a style="display:none">{{form.time_real}}</a>
        {% endif %}
    {% endfor %}
    <button type="submit" name='edit' class="btn btn-default">修正</button>
    <button type="submit" name='add' class="btn btn-primary">追加</button>
</form><br>
<form action="{% url 'cms:task_mod' %}" method="GET">
    <h4>明日のタスク</h4><br>
    {{ task_form_next.management_form }}
    {% for form in task_form_next %}
        {% csrf_token %}
        {% if forloop.last %}
            {{form.id}}
            {{form.complete_task}}
            {{form.implement_date.label_tag}}{{form.implement_date}}
            {{form.name}}<br>
            予定{{form.time_plan}}
            /実績{{form.time_real}}<br>
        {% else %}
            {{form.id}}
            {{form.complete_task}}
            {{form.implement_date.label_tag}}{{form.implement_date.value}}
            {{form.name.value}}<br>
            予定{{form.time_plan.value}}
            /実績{{form.time_real}}<br>
            <a style="display:none">{{form.implement_date}}</a>
            <a style="display:none">{{form.name}}</a>
            <a style="display:none">{{form.time_plan}}</a>
            <a style="display:none">{{form.time_real}}</a>
        {% endif %}
    {% endfor %}
    <button type="submit" name='edit' class="btn btn-default">修正</button>
    <button type="submit" name='add' class="btn btn-primary">追加</button>
    <a href="{% url 'cms:task_mod' %}" class="btn btn-default">すべてのタスク</a>
</form><br>


{% endblock content %}