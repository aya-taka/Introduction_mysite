{% extends "base.html" %}
{% load markdown_deux_tags %}
{% load bootstrap %}
{% block title %}日報の詳細{% endblock title %}

{% block content %}
<form method="post" action="{% url 'cms:daily_search' %}">
{% csrf_token %}
<table>
    <tr>
        <td>{{ form.keyword }}</td>
        <td><button type="submit" class="btn btn-default btn-sm">検索</button></td>
    </tr>
</table>
</form>
<h3 class="page-header">{{ daily.title }}</h3>
<div class="panel panel-default">
    <div class="panel-heading">
        投稿者：　{{ daily.user }}
        {% if daily.user == user %}
            {% if daily.release %}
                <a href="{% url 'cms:daily_mod' daily_id=daily.id %}" class="btn btn-default btn-sm">編集</a>
            {% else %}
                <a href="{% url 'cms:daily_mod' daily_id=daily.id %}" class="btn btn-primary">修正して公開する</a>
            {% endif %}
        {% endif %}
    </div>
    <div class="panel-body">
        <h4><text>
            {{ daily.report|markdown }}
        </text></h4>
    </div>
</div>
{% if daily.release %}
<table class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>投稿者</th>
            <th>コメント</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for comment in comments %}
        <tr>
            <td>{{ comment.user }}</td>
            <td>{{ comment.comment }}</td>
            {% if comment.user == user %}
                <td>
                    <a href="{% url 'cms:comment_mod' daily_id=daily.id comment_id=comment.id %}" class="btn btn-default btn-sm">修正</a>
                    <button class="btn btn-default btn-sm del_confirm" data-toggle="modal" data-target="#deleteModal" pk="{{ comment.id }}" url="{% url 'cms:comment_del' daily_id=daily.id comment_id=comment.id %}">削除</button>
                </td>
            {% else %}
                <td></td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>
<form action="{% url 'cms:comment_add' daily_id=daily.id %}" method="post" class="form-horizontal" role="form">
    {% csrf_token %}
    {{ commentForm|bootstrap_horizontal }}
    <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
            <button type="submit" class="btn btn-primary">投稿</button>
        </div>
    </div>
</form>
{% endif %}
{% endblock content %}