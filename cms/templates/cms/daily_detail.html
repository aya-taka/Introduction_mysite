{% extends "base.html" %}
{% load markdown_deux_tags %}
{% load bootstrap %}
{% block title %}日報の詳細{% endblock title %}

{% block content %}
<h3 class="page-header">{{ daily.title }}</h3>
<div class="panel panel-default">
    <div class="panel-heading">
        投稿者：　{{ daily.user }}
        {% if daily.user == user %}
            {% if daily.release %}
                <a href="{% url 'cms:daily_mod' daily_id=daily.id %}" class="btn btn-default btn-sm">編集</a>
            {% else %}
                <a href="{% url 'cms:daily_mod' daily_id=daily.id %}" class="btn btn-primary">修正して公開する</a>
            {% endif %}
        {% endif %}
    </div>
    <div class="panel-body">
        <h3>Y:やったこと</h3>
        {% for task in task_y %}
            <h4><text>
                {{ task.name }}<br>
                予定：{{ task.time_plan }}/実績：{{ task.time_real }}
            </text></h4>
        {% endfor %}
    </div>
    <div class="panel-body">
        <h3>W:わかったこと</h3>
        <h4><text>
            {{ daily.report_w|markdown }}
        </text></h4>
    </div>
    <div class="panel-body">
        <h3>T:つぎにやること</h3>
        {% for task in task_t %}
            <h4><text>
                {{ task.name }}<br>
                予定：{{ task.time_plan }}/実績：{{ task.time_real }}
            </text></h4>
        {% endfor %}
    </div>
</div>
{% if daily.release %}
<table class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>投稿者</th>
            <th>コメント</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for comment in comments %}
        <tr>
            <td>{{ comment.user }}</td>
            <td>{{ comment.comment }}</td>
            {% if comment.user == user %}
                <td>
                    <a href="{% url 'cms:comment_mod' daily_id=daily.id comment_id=comment.id %}" class="btn btn-default btn-sm">修正</a>
                    <button class="btn btn-default btn-sm del_confirm" data-toggle="modal" data-target="#deleteModal" pk="{{ comment.id }}" url="{% url 'cms:comment_del' daily_id=daily.id comment_id=comment.id %}">削除</button>
                </td>
            {% else %}
                <td></td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>
<form action="{% url 'cms:comment_add' daily_id=daily.id %}" method="post" class="form-horizontal" role="form">
    {% csrf_token %}
    {{ comment_form|bootstrap_horizontal }}
    <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
            <button type="submit" class="btn btn-primary">投稿</button>
        </div>
    </div>
</form>
{% endif %}
{% endblock content %}